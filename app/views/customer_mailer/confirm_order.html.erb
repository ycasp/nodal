<!-- Success banner -->
<table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0" style="margin: 0 0 32px 0;">
  <tr>
    <td style="background: linear-gradient(135deg, #008060 0%, #00a67d 100%); background-color: #008060; border-radius: 12px; padding: 24px; text-align: center;">
      <table role="presentation" cellspacing="0" cellpadding="0" border="0" align="center">
        <tr>
          <td style="background-color: rgba(255,255,255,0.2); border-radius: 50%; width: 48px; height: 48px; text-align: center; vertical-align: middle;">
            <span style="font-size: 24px; line-height: 48px;">‚úì</span>
          </td>
        </tr>
      </table>
      <h1 style="margin: 16px 0 0 0; font-size: 24px; font-weight: 700; color: #ffffff;">
        Order Confirmed!
      </h1>
    </td>
  </tr>
</table>

<p style="margin: 0 0 8px 0; font-size: 16px;">Hello <strong><%= @customer.contact_name %></strong>,</p>

<p style="margin: 0 0 32px 0; color: #4b5563;">
  Great news! Your order has been confirmed and is being processed. Here's a summary of what you ordered:
</p>

<!-- Order items card -->
<table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0" style="margin: 0 0 32px 0; border: 1px solid #e5e5e5; border-radius: 12px; overflow: hidden;">
  <!-- Card header -->
  <tr>
    <td colspan="3" style="padding: 16px 20px; background-color: #f9fafb; border-bottom: 1px solid #e5e5e5;">
      <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
        <tr>
          <td>
            <span style="font-size: 14px; font-weight: 600; color: #1a1a1a; text-transform: uppercase; letter-spacing: 0.5px;">Order Summary</span>
          </td>
          <td align="right">
            <span style="font-size: 13px; color: #6b7177;"><%= @order.order_items.count %> item<%= @order.order_items.count != 1 ? 's' : '' %></span>
          </td>
        </tr>
      </table>
    </td>
  </tr>
  <!-- Table header -->
  <tr>
    <td style="padding: 12px 20px; background-color: #ffffff; border-bottom: 1px solid #f3f4f6; font-size: 12px; font-weight: 600; color: #9ca3af; text-transform: uppercase; letter-spacing: 0.5px;">
      Product
    </td>
    <td align="center" style="padding: 12px 16px; background-color: #ffffff; border-bottom: 1px solid #f3f4f6; font-size: 12px; font-weight: 600; color: #9ca3af; text-transform: uppercase; letter-spacing: 0.5px; width: 60px;">
      Qty
    </td>
    <td align="right" style="padding: 12px 20px; background-color: #ffffff; border-bottom: 1px solid #f3f4f6; font-size: 12px; font-weight: 600; color: #9ca3af; text-transform: uppercase; letter-spacing: 0.5px; width: 100px;">
      Price
    </td>
  </tr>
  <!-- Order items -->
  <% @order.order_items.each_with_index do |item, index| %>
    <tr>
      <td style="padding: 16px 20px; background-color: #ffffff; <%= index < @order.order_items.count - 1 ? 'border-bottom: 1px solid #f3f4f6;' : '' %>">
        <span style="font-size: 15px; font-weight: 500; color: #1a1a1a;"><%= item.product.name %></span>
        <% if item.discount_percentage && item.discount_percentage > 0 %>
          <span style="display: inline-block; margin-left: 8px; background-color: #dcfce7; color: #166534; font-size: 11px; font-weight: 600; padding: 2px 8px; border-radius: 10px;">-<%= (item.discount_percentage * 100).round(0) %>%</span>
        <% end %>
      </td>
      <td align="center" style="padding: 16px; background-color: #ffffff; <%= index < @order.order_items.count - 1 ? 'border-bottom: 1px solid #f3f4f6;' : '' %>">
        <span style="display: inline-block; background-color: #f3f4f6; padding: 4px 12px; border-radius: 20px; font-size: 14px; font-weight: 600; color: #4b5563;"><%= item.quantity %></span>
      </td>
      <td align="right" style="padding: 16px 20px; background-color: #ffffff; <%= index < @order.order_items.count - 1 ? 'border-bottom: 1px solid #f3f4f6;' : '' %>">
        <% if item.discount_percentage && item.discount_percentage > 0 %>
          <span style="font-size: 13px; color: #9ca3af; text-decoration: line-through; display: block;"><%= (item.price * item.quantity).format %></span>
        <% end %>
        <span style="font-size: 15px; font-weight: 500; color: #1a1a1a;"><%= item.total_price.format %></span>
      </td>
    </tr>
  <% end %>

  <!-- Totals section -->
  <tr>
    <td colspan="3" style="padding: 0; background-color: #f9fafb; border-top: 2px solid #e5e5e5;">
      <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
        <!-- Subtotal -->
        <tr>
          <td style="padding: 12px 20px;">
            <span style="font-size: 14px; color: #6b7177;">Subtotal</span>
          </td>
          <td align="right" style="padding: 12px 20px;">
            <span style="font-size: 14px; color: #1a1a1a;"><%= @order.total_amount.format %></span>
          </td>
        </tr>

        <% if @order.has_auto_discount_snapshot? %>
          <!-- Order Tier Discount -->
          <tr>
            <td style="padding: 8px 20px;">
              <span style="font-size: 14px; color: #166534;">Order Tier Discount (<%= @order.auto_discount_display %>)</span>
            </td>
            <td align="right" style="padding: 8px 20px;">
              <span style="font-size: 14px; color: #166534;">-<%= @order.auto_order_discount_amount.format %></span>
            </td>
          </tr>
        <% end %>

        <% if @order.has_order_discount? %>
          <!-- Manual Discount -->
          <tr>
            <td style="padding: 8px 20px;">
              <span style="font-size: 14px; color: #166534;">
                Discount (<%= @order.order_discount_display %>)
                <% if @order.discount_reason.present? %>
                  <span style="display: block; font-size: 12px; color: #9ca3af;"><%= @order.discount_reason %></span>
                <% end %>
              </span>
            </td>
            <td align="right" style="padding: 8px 20px;">
              <span style="font-size: 14px; color: #166534;">-<%= @order.order_discount_amount.format %></span>
            </td>
          </tr>
        <% end %>

        <!-- Tax -->
        <tr>
          <td style="padding: 8px 20px;">
            <span style="font-size: 14px; color: #6b7177;">Tax (<%= (@order.organisation.tax_rate * 100).round(1) %>%)</span>
          </td>
          <td align="right" style="padding: 8px 20px;">
            <span style="font-size: 14px; color: #1a1a1a;"><%= (@order.tax_amount || @order.calculated_tax).format %></span>
          </td>
        </tr>

        <!-- Shipping -->
        <tr>
          <td style="padding: 8px 20px;">
            <span style="font-size: 14px; color: #6b7177;">
              Shipping
              <% if @order.pickup? %>
                <span style="display: inline-block; margin-left: 6px; background-color: #e5e7eb; color: #4b5563; font-size: 11px; font-weight: 500; padding: 2px 8px; border-radius: 10px;">Pickup</span>
              <% end %>
            </span>
          </td>
          <td align="right" style="padding: 8px 20px;">
            <span style="font-size: 14px; color: #1a1a1a;"><%= (@order.shipping_amount || @order.calculated_shipping).format %></span>
          </td>
        </tr>

        <!-- Grand Total -->
        <tr>
          <td style="padding: 16px 20px; border-top: 1px solid #e5e5e5;">
            <span style="font-size: 16px; font-weight: 700; color: #1a1a1a;">Total</span>
          </td>
          <td align="right" style="padding: 16px 20px; border-top: 1px solid #e5e5e5;">
            <span style="font-size: 20px; font-weight: 700; color: #008060;"><%= @order.grand_total.format %></span>
          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>

<!-- Order Details -->
<table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0" style="margin: 0 0 32px 0; border: 1px solid #e5e5e5; border-radius: 12px; overflow: hidden;">
  <tr>
    <td style="padding: 16px 20px; background-color: #f9fafb; border-bottom: 1px solid #e5e5e5;">
      <span style="font-size: 14px; font-weight: 600; color: #1a1a1a; text-transform: uppercase; letter-spacing: 0.5px;">Order Details</span>
    </td>
  </tr>
  <tr>
    <td style="padding: 20px;">
      <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
        <tr>
          <td style="padding-bottom: 16px; width: 50%; vertical-align: top;">
            <span style="font-size: 12px; color: #9ca3af; text-transform: uppercase; letter-spacing: 0.5px;">Order Number</span>
            <p style="margin: 4px 0 0 0; font-size: 15px; font-weight: 600; color: #1a1a1a;"><%= @order.order_number %></p>
          </td>
          <td style="padding-bottom: 16px; width: 50%; vertical-align: top;">
            <span style="font-size: 12px; color: #9ca3af; text-transform: uppercase; letter-spacing: 0.5px;">Order Date</span>
            <p style="margin: 4px 0 0 0; font-size: 15px; font-weight: 600; color: #1a1a1a;"><%= @order.placed_at&.strftime("%B %d, %Y") || @order.created_at.strftime("%B %d, %Y") %></p>
          </td>
        </tr>
        <tr>
          <td style="padding-bottom: 16px; width: 50%; vertical-align: top;">
            <span style="font-size: 12px; color: #9ca3af; text-transform: uppercase; letter-spacing: 0.5px;">Delivery Method</span>
            <p style="margin: 4px 0 0 0; font-size: 15px; font-weight: 600; color: #1a1a1a;">
              <% if @order.pickup? %>
                üè™ Pickup
              <% else %>
                üöö Delivery
              <% end %>
            </p>
          </td>
          <td style="padding-bottom: 16px; width: 50%; vertical-align: top;">
            <span style="font-size: 12px; color: #9ca3af; text-transform: uppercase; letter-spacing: 0.5px;"><%= @order.pickup? ? 'Pickup Date' : 'Delivery Date' %></span>
            <p style="margin: 4px 0 0 0; font-size: 15px; font-weight: 600; color: #1a1a1a;"><%= @order.receive_on&.strftime("%B %d, %Y") || 'To be confirmed' %></p>
          </td>
        </tr>
        <% if @order.delivery? && @order.shipping_address.present? %>
          <tr>
            <td colspan="2" style="padding-bottom: 16px; vertical-align: top;">
              <span style="font-size: 12px; color: #9ca3af; text-transform: uppercase; letter-spacing: 0.5px;">Shipping Address</span>
              <p style="margin: 4px 0 0 0; font-size: 15px; color: #1a1a1a;">
                <%= @order.shipping_address.street_name %><br>
                <span style="color: #6b7177;"><%= @order.shipping_address.postal_code %> <%= @order.shipping_address.city %>, <%= @order.shipping_address.country %></span>
              </p>
            </td>
          </tr>
        <% end %>
      </table>
    </td>
  </tr>
</table>

<!-- What's next section -->
<table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0" style="margin: 0 0 24px 0;">
  <tr>
    <td style="padding: 20px; background-color: #f0fdf4; border-radius: 12px; border-left: 4px solid #008060;">
      <p style="margin: 0 0 8px 0; font-size: 14px; font-weight: 600; color: #166534;">What's next?</p>
      <p style="margin: 0; font-size: 14px; color: #4b5563; line-height: 1.5;">
        We're preparing your order now. You'll receive another email when it's ready for <%= @order.pickup? ? 'pickup' : 'delivery' %>.
      </p>
    </td>
  </tr>
</table>

<p style="margin: 0; color: #9ca3af; font-size: 13px; text-align: center;">
  Questions about your order? Just reply to this email.
</p>
